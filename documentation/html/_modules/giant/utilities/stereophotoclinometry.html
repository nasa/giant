<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>giant.utilities.stereophotoclinometry &#8212; GIANT 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=3f530b75" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=aae3c237" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/logo.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">A powerful API for Optical Navigation</p>






<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installing GIANT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html#indices">Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <h1>Source code for giant.utilities.stereophotoclinometry</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides a number of classes for interfacing with files used in the Stereophotoclinometry (SPC) software</span>
<span class="sd">suite for performing shape modelling and surface feature navigation.</span>

<span class="sd">This module *does not* provide the same functionality that the SPC software does, instead it just provides the ability</span>
<span class="sd">to view, manipulate, and write SPC files and makes it easy to transform SPC data into a format that GIANT</span>
<span class="sd">can use.  This module does assume some level of familiarity with the SPC software and files, so descriptions</span>
<span class="sd">are brief.  See the SPC wiki for more details at https://web.psi.edu/spc_wiki/HomePage</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>  <span class="c1"># we need the struct stuff to handle the conversion to binary</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Literal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">giant.ray_tracer.shapes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">giant.utilities.mixin_classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">AttributeEqualityComparison</span><span class="p">,</span> <span class="n">AttributePrinting</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">giant._typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">NONENUM</span><span class="p">,</span> <span class="n">NONEARRAY</span>


<span class="n">DATE_FMT</span> <span class="o">=</span> <span class="s1">&#39;%Y %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the observation_date format used in SPC summary and nominal files.  It is used to parse and write the dates</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Summary">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.html#giant.utilities.stereophotoclinometry.Summary">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Summary</span><span class="p">(</span><span class="n">AttributeEqualityComparison</span><span class="p">,</span> <span class="n">AttributePrinting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read/write from the SPC summary (.SUM) files.</span>

<span class="sd">    The summary files represent meta data about an Image.  The image data itself is stored in a corresponding</span>
<span class="sd">    .DAT file which can be read/written with the :class:`Image` class.  When creating an instance of this class,</span>
<span class="sd">    you can enter the ``file_name`` argument, in which case the specified SUM file will be opened and read into the</span>
<span class="sd">    members of this class (if the sum file exists), or you can specify the individual components of the sum file as</span>
<span class="sd">    keyword arguments.  If you specify both an existing SUM file and keyword arguments for the individual</span>
<span class="sd">    components of the SUM file, the keyword arguments will override whatever is read from the file.</span>

<span class="sd">    The documentation for each instance attribute of this class specifies the corresponding location in the SUM file</span>
<span class="sd">    for clarification and reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">observation_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_illum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_illum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">principle_point</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">direction_target_to_sun</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">intrinsic_matrix</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">near_dist_params</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param image_name: The name of the image this object corresponds to</span>
<span class="sd">        :param observation_date: The utc observation observation_date for the image as a python datetime object</span>
<span class="sd">        :param num_cols: The number of columns in the image array</span>
<span class="sd">        :param num_rows: The number of rows in the image array</span>
<span class="sd">        :param min_illum: The minimum illumination value to allow for an image.  SPC ignores pixels with DN values</span>
<span class="sd">                          below this</span>
<span class="sd">        :param max_illum: The maximum illumination value to allow for an image.  SPC ignores pixels wiht DN values</span>
<span class="sd">                          above this.</span>
<span class="sd">        :param focal_length: The focal length of the camera in units of millimeters</span>
<span class="sd">        :param principle_point: The principal point of the camera (location where the optical axis pierces the image</span>
<span class="sd">                                plane) in units of pixels.</span>
<span class="sd">        :param position_camera_to_target: The vector from the spacecraft to the target in the target body fixed frame as</span>
<span class="sd">                                          a length 3 numpy array</span>
<span class="sd">        :param rotation_target_fixed_to_camera: The 3x3 rotation matrix from the target body fixed frame to the camera</span>
<span class="sd">                                                frame</span>
<span class="sd">        :param direction_target_to_sun: The unit vector from the target to the sun in the target body fixed frame</span>
<span class="sd">        :param intrinsic_matrix: The intrinsic matrix of the camera (see the :mod:`~.pinhole_model` documentation</span>
<span class="sd">                                 for details</span>
<span class="sd">        :param near_dist_params: This obsolete array contains special distortion values for the cameras that were flown</span>
<span class="sd">                                 on NEAR.  This should be all 0 for all modern SPC use.</span>
<span class="sd">        :param sig_pos_camera_to_target: This is the formal uncertainty on the ``position_camera_to_target`` vector</span>
<span class="sd">                                         (1 sigma)</span>
<span class="sd">        :param sig_rot_target_fixed_to_camera: This is the formal uncertainty on the spacecraft pointing</span>
<span class="sd">                                               (roll, pitch, yaw?) (1 sigma)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the summary file that this object was populated from.</span>
<span class="sd">        </span>
<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>
<span class="sd">        </span>
<span class="sd">        Typically this is named according to SUMFILES/*IMAGENAME*.SUM where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the image this object corresponds to.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first line of the SUM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the empty string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The middle of the time in UTC that the image was exposed during as a python datetime object.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second line of the SUM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to January 1, 2000 00:00:00 UTC</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The integer number of columns in the image this Summary object corresponds to.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to -1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The integer number of rows in the image this Summary object corresponds to.</span>

<span class="sd">        This corresponds to the second value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to -1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The minimum DN value for a pixel to be used in SPC.</span>
<span class="sd">        </span>
<span class="sd">        Pixels with DN values below this threshold are ignored when computing correlation coefficients and other values</span>
<span class="sd">        in SPC.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the third value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to -sys.maxsize-1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum DN value for a pixel to be used in SPC.</span>

<span class="sd">        Pixels with DN values above this threshold are ignored when computing correlation coefficients and other values</span>
<span class="sd">        in SPC.</span>

<span class="sd">        This corresponds to the fourth value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        </span>
<span class="sd">        Default to sys.maxsize * 2 + 1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The focal length of the camera in units of mm.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first value of the line containing ``MMFL, CTR`` in the SUM file (typically the fourth</span>
<span class="sd">        line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The principle point of the camera as a length 2 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This typically corresponds to the :attr:`.PinholeModel.px` and :attr:`.PinholeModel.py` attributes of the</span>
<span class="sd">        Pinhole based camera models in GIANT.  The first component is for the x-axis (columns) and the second component</span>
<span class="sd">        is for the y-axis (rows).</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second and third values of the line containing ``MMFL, CTR`` in the SUM file (typically </span>
<span class="sd">        the fourth line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The position vector from the spacecraft to the target in target body fixed coordinates at the time of the image</span>
<span class="sd">        with units of kilometers as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all the values of the line containing ``SCOBJ`` in the SUM file (typically the fifth line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the target body fixed frame to the camera frame at the time of the image as a</span>
<span class="sd">        shape 3x3 numpy array of floats.</span>

<span class="sd">        This corresponds to all the values of the lines containing ``CX, CY, CZ`` in the SUM file (typically the </span>
<span class="sd">        sixth through the eighth lines).  The matrix is formed according to ``np.vstack([CX, CY, CZ])`` </span>
<span class="sd">        </span>
<span class="sd">        Defaults to a 3x3 matrix of all 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unit vector from the target to the sun in the target body fixed frame at the time of the image as a length</span>
<span class="sd">        3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all the values of the line containing ``SZ`` in the sum file (typically the ninth line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The intrinsic matrix of the camera as a shape 2x3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This has an extra column that is kept for SPC compatibility reasons but which is not used anymore.  Therefore,</span>
<span class="sd">        this does not directly correspond to the :attr:`.PinholeModel.intrinsic_matrix` attribute of the Pinhole model </span>
<span class="sd">        and its subclasses in GIANT, but rather the first 2 columns of this matrix correspond to the first 2 columns of</span>
<span class="sd">        the intrinsic matrix in GIANT and the 3rd column should be discarded.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``K-MATRIX`` in the SUM file (typically the</span>
<span class="sd">        tenth line).  Weirdly this is a row major flattening of the intrinsic matrix in the SUM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to a 2x3 array of all zeros.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The deprecated NEAR distortion parameters.</span>
<span class="sd">        </span>
<span class="sd">        Just leave these at 0.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``DISTORTION`` in the SUM file (typically the </span>
<span class="sd">        eleventh line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the position_camera_to_target vector as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        The formal uncertainty are the 1 sigma values for each component of the position vector.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_VSO`` in the SUM file (typically the </span>
<span class="sd">        twelfth line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the rotation from the target body frame to the spacecraft frame as a length 3 numpy </span>
<span class="sd">        array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_PTG`` in the SUM file (typically the </span>
<span class="sd">        thirteenth line).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A dictionary of observed SPC landmarks and their observed locations in units of pixels.</span>
<span class="sd">        </span>
<span class="sd">        The keys to the dictionary are the SPC landmark names (typically 6 character alpha numeric names) </span>
<span class="sd">        and the values are the pixel location the landmark was identified at in the image. Each value is the x, y or </span>
<span class="sd">        column, row location as a length 2 list of floats </span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the lines between ``LANDMARKS`` and ``LIMB FITS`` or ``END FILE`` in the SUM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an empty dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A dictionary of observed SPC landmarks that occur on the limb of the target in the image and their observed </span>
<span class="sd">        locations in units of pixels and formal uncertainty.</span>

<span class="sd">        The keys to the dictionary are the SPC landmark names (typically 6 character alpha numeric names) </span>
<span class="sd">        and the values are the pixel location the landmark was identified at in the image followed by the uncertainty of</span>
<span class="sd">        the fit. Each value is the x, y, sigma or </span>
<span class="sd">        column, row, sigma as a length 3 list of floats </span>

<span class="sd">        This corresponds to all of the lines between ``LIMB FITS`` and ``LANDMARKS`` or ``END FILE`` in the SUM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an empty dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="c1"># override anything that was manually specified</span>
        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span>

        <span class="k">if</span> <span class="n">observation_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">observation_date</span>

        <span class="k">if</span> <span class="n">num_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span> <span class="o">=</span> <span class="n">num_cols</span>

        <span class="k">if</span> <span class="n">num_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">num_rows</span>

        <span class="k">if</span> <span class="n">min_illum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span> <span class="o">=</span> <span class="n">min_illum</span>

        <span class="k">if</span> <span class="n">max_illum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">=</span> <span class="n">max_illum</span>

        <span class="k">if</span> <span class="n">focal_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="n">focal_length</span>

        <span class="k">if</span> <span class="n">principle_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">principle_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">position_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">position_camera_to_target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rotation_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">direction_target_to_sun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">direction_target_to_sun</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intrinsic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intrinsic_matrix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">near_dist_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">near_dist_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sig_pos_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sig_rot_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span>

<div class="viewcode-block" id="Summary.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.read.html#giant.utilities.stereophotoclinometry.Summary.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC SUM file (normally SUMFILES/*IMAGENAME*.SUM) and populates the attributes of</span>
<span class="sd">        this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_file</span><span class="p">:</span>

                <span class="c1"># parse the name and observation_date lines (first two lines</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">DATE_FMT</span><span class="p">)</span>

                <span class="c1"># parse the size of the Image and the dynamic range of the Image values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                                                                                             <span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the focal length and the principal point of the camera</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the spacecraft to object position vector</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the object to camera rotation matrix</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sun direction vector</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the intrinsic calibration matrix</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                <span class="c1"># parse the near distortion parameters</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sigma_VSO values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sigma_PTG values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># read in the landmark and limb data</span>
                <span class="k">if</span> <span class="s2">&quot;landmarks&quot;</span> <span class="ow">in</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>

                    <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">maplet_names</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">maplet_image_locs_list</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">while</span> <span class="p">(</span><span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;limb&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                        <span class="n">split_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">maplet_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                        <span class="n">maplet_image_locs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>

                        <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">maplet_names</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">maplet_names</span><span class="p">,</span> <span class="n">maplet_image_locs_list</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># read in any limb fits</span>
                <span class="k">if</span> <span class="s1">&#39;limb&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>

                    <span class="n">limb_names</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">limb_image_locs_list</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">while</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">split_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">limb_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                        <span class="n">limb_image_locs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>  <span class="c1"># location</span>
                                                     <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>  <span class="c1"># sigma</span>

                        <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">limb_names</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">limb_names</span><span class="p">,</span> <span class="n">limb_image_locs_list</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;The file </span><span class="si">{}</span><span class="s1"> does not exist.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>


<div class="viewcode-block" id="Summary.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.write.html#giant.utilities.stereophotoclinometry.Summary.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Summary.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Summary.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:20.10E}</span><span class="s1"> </span><span class="si">{1:19.10E}</span><span class="s1"> </span><span class="si">{2:19.10E}</span><span class="s1">   &#39;</span>

        <span class="n">name_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>

        <span class="n">date_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATE_FMT</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">image_line</span> <span class="o">=</span> <span class="s1">&#39;  </span><span class="si">{0:4d}</span><span class="s1">  </span><span class="si">{1:4d}</span><span class="s1">   </span><span class="si">{2:3d}</span><span class="s1"> </span><span class="si">{3:5d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">39</span> <span class="o">+</span> <span class="s1">&#39;NPX, NLN, THRSH</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">camera_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">,</span>
                                           <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;MMFL, CTR</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">position_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SCOBJ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">rot_x_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CX</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_y_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CY</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_z_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sun_direction_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">intrinsic_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:10.5f}</span><span class="s1"> </span><span class="si">{1:9.5f}</span><span class="s1"> </span><span class="si">{2:9.5f}</span><span class="s1"> </span><span class="si">{3:9.5f}</span><span class="s1"> </span><span class="si">{4:9.5f}</span><span class="s1"> </span><span class="si">{5:9.5f}</span><span class="s1">   &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;K-MATRIX</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">distortion_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:15.5E}</span><span class="s1"> </span><span class="si">{1:14.5E}</span><span class="s1"> </span><span class="si">{2:14.5E}</span><span class="s1"> </span><span class="si">{3:14.5E}</span><span class="s1">   DISTORTION</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">distortion_line</span> <span class="o">=</span> <span class="n">distortion_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

        <span class="n">sig_vso_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SIG_VSO</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sig_ptg_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SIG_PTG</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">fit_formats</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:6s}</span><span class="s1"> </span><span class="si">{1:9.2f}</span><span class="s1"> </span><span class="si">{2:10.2f}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">maplet_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">limb_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">map_name</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">maplet_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_formats</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_name</span><span class="p">,</span> <span class="o">*</span><span class="n">location</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">limb_name</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">limb_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_formats</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">limb_name</span><span class="p">,</span> <span class="o">*</span><span class="n">location</span><span class="p">))</span>

        <span class="c1"># open/create the file for writing</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_file</span><span class="p">:</span>

            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">date_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camera_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">position_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_x_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_y_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_z_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sun_direction_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">intrinsic_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">distortion_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_vso_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_ptg_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LANDMARKS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">maplet_lines</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LIMB FITS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">limb_lines</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END FILE&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Image">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.html#giant.utilities.stereophotoclinometry.Image">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Image</span><span class="p">(</span><span class="n">AttributePrinting</span><span class="p">,</span> <span class="n">AttributeEqualityComparison</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Image files (.DAT).</span>

<span class="sd">    The Image files contain the 2D image data for SPC processing.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>

<span class="sd">    Because the image files are a minimal format, you must specify the number of columns, number of rows, and maximum</span>
<span class="sd">    illumination value in addition to the file name.  These can be determined by reading the corresponding summary file</span>
<span class="sd">    for the image (:class:`.Summary`).  As an alternative to the maximum illumination you can specify the integer size</span>
<span class="sd">    and endianess arguments if known.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">maximum_illumination</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">integer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endianess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">data</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param n_cols: The number of columns in the image</span>
<span class="sd">        :param n_rows: The number of rows in the image</span>
<span class="sd">        :param maximum_illumination: The maximum illumination value that is possible in the image.  This is used</span>
<span class="sd">                                     to attempt to discern the endianess of the file, so it typically should be set to</span>
<span class="sd">                                     either 255 for 8 bit or 65535 for 16 bit.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the image file that this object was populated from.</span>

<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>

<span class="sd">        Typically this is named according to IMAGEFILES/*IMAGENAME*.DAT where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_cols</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of columns in the image. </span>
<span class="sd">        </span>
<span class="sd">        This must be specified before the image file is read.  It can be determined by the :attr:`.Summary.n_cols` </span>
<span class="sd">        attribute from the corresponding summary file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_rows</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of rows in the image. </span>

<span class="sd">        This must be specified before the image file is read.  It can be determined by the :attr:`.Summary.n_rows` </span>
<span class="sd">        attribute from the corresponding summary file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">maximum_illumination</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum possible illumination for an image.</span>
<span class="sd">        </span>
<span class="sd">        This is used to try to discern the endianess of the file if it is not known and the file has 16 bit integers, </span>
<span class="sd">        but it is not foolproof.  If you know the endianess of the file you should specify that instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">integer_size</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of bytes for each integer in the file.</span>
<span class="sd">        </span>
<span class="sd">        This is discerned from the total number of bytes in the file vs the total number of pixels computed from </span>
<span class="sd">        :attr:`n_rows` and :attr:`n_cols`. A value of 1 indicates an 8 bit integer while a value of 2 indicates a 16 </span>
<span class="sd">        bit integer.  If you know this already then you can specify it to increase reading speed slightly.  </span>
<span class="sd">        </span>
<span class="sd">        This is required to be not ``None`` before a call to write is made.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">endianess</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The endianess of the data in the file if it is stored in 16 bit integers.  </span>
<span class="sd">        </span>
<span class="sd">        This may be able to be inferred if it is not known and the :attr:`maximum_illumination` value is specified; </span>
<span class="sd">        however, this is not foolproof and may not work.  Therefore, if you know the endianess for 16 bit files you </span>
<span class="sd">        should specify it.  </span>
<span class="sd">        </span>
<span class="sd">        This should be either &#39;&gt;&#39; for big-endian, &#39;&lt;&#39; for little-endian&#39;, or &#39;=&#39; for machine endianess</span>
<span class="sd">        </span>
<span class="sd">        This must be specified before a call to :meth:`write` if the integer size is 16 bit.  This doesn&#39;t matter if the</span>
<span class="sd">        integer size is 8 bit.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The actual image data as a 2D numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># try to infer the other attributes if need be</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;unsigned integer&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">=</span> <span class="mi">255</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">=</span> <span class="mi">65535</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s1">&#39;|&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span>
                        
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
<div class="viewcode-block" id="Image.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.read.html#giant.utilities.stereophotoclinometry.Image.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Image file (normally ``IMAGEFILES/*IMAGENAME*.DAT``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The file must be provided before a call to read&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The number of rows and columns in the image must be specified before calling read&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get the number of bytes by going to the end of the file, getting the position,</span>
                <span class="c1"># and then rewinding to the beginning of the file</span>
                <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">num_bytes</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

                <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># determine whether this is 1 or 2 byte integers</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>

            <span class="c1"># if the data is 2byte</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="c1"># read in the data as big endian</span>
                    <span class="n">illums_big_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

                    <span class="c1"># reset back to the beginning of the file</span>
                    <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># read in the data as little endian</span>
                    <span class="n">illums_little_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&lt;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_big_e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_little_e</span><span class="p">):</span>
                        <span class="c1"># if the data is big endian</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">illums_big_e</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span>

                    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_little_e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_big_e</span><span class="p">):</span>
                        <span class="c1"># if the data is little endian</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">illums_little_e</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># otherwise something went wrong</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;It appears like the file has been corrupted (Can&#39;t determine endianness&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">+</span> <span class="s2">&quot;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span>
                                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Image.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.write.html#giant.utilities.stereophotoclinometry.Image.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the file contained in the Image object to a dat file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Image.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Nominal.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Integer size must be specified to write to a Image file.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data must not be None on a call to write&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;u1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Endianess must be specified for a 2 byte integer&#39;</span><span class="p">)</span>

                <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">+</span> <span class="s1">&#39;u2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="Nominal">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.html#giant.utilities.stereophotoclinometry.Nominal">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Nominal</span><span class="p">(</span><span class="n">AttributeEqualityComparison</span><span class="p">,</span> <span class="n">AttributePrinting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read/write from the SPC Nominal (.NOM) files.</span>

<span class="sd">    The nominal files represent meta data about an Image as original loaded with updated values being stored in the</span>
<span class="sd">    Summary (.SUM) files.  The image data itself is stored in a corresponding .DAT file which can be read/written with</span>
<span class="sd">    the :class:`Image` class.  When creating an instance of this class, you can enter the ``file_name`` argument, in</span>
<span class="sd">    which case the specified NOM file will be opened and read into the members of this class (if the file exists), or</span>
<span class="sd">    you can specify the individual components of the file as keyword arguments.  If you specify both an existing</span>
<span class="sd">    NOM file and keyword arguments for the individual components of the NOM file, the keyword arguments will override</span>
<span class="sd">    whatever is read from the file.</span>

<span class="sd">    The documentation for each instance attribute of this class specifies the corresponding location in the NOM file</span>
<span class="sd">    for clarification and reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ending</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param image_name: The name of the image this object corresponds to</span>
<span class="sd">        :param position_camera_to_target: The vector from the spacecraft to the target in the target body fixed frame as</span>
<span class="sd">                                          a length 3 numpy array as originally specified</span>
<span class="sd">        :param velocity: The velocity of the camera</span>
<span class="sd">        :param rotation_target_fixed_to_camera: The 3x3 rotation matrix from the target body fixed frame to the camera</span>
<span class="sd">                                                frame</span>
<span class="sd">        :param sig_pos_camera_to_target: This is the formal uncertainty on the ``position_camera_to_target`` vector</span>
<span class="sd">                                         (1 sigma) as originally specified</span>
<span class="sd">        :param sig_rot_target_fixed_to_camera: This is the formal uncertainty on the spacecraft pointing</span>
<span class="sd">                                               (roll, pitch, yaw?) (1 sigma) as originally specified</span>
<span class="sd">        :param frame: This specifies the frame the position uncertainty is experessed in</span>
<span class="sd">        :param ending: This specifies stuff that goes at the end of the nominal file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># predefine the attributes of the class for readability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the nominal file that this object was populated from.</span>

<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>

<span class="sd">        Typically this is named according to NOMINALS/*IMAGENAME*.NOM where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the image this object corresponds to.</span>

<span class="sd">        This corresponds to the first line of the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The position vector from the spacecraft to the target in target body fixed coordinates at the time of the image</span>
<span class="sd">        with units of kilometers as a length 3 numpy array of floats.  This represents the vector as originally loaded </span>
<span class="sd">        into SPC (usually from SPICE).  That means this typically is not updated.</span>

<span class="sd">        This corresponds to all the values of the line containing ``SCOBJ`` in the NOM file, usually the 3rd line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The velocity of the camera with units of kilometers per second as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second line in the NOM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the target body fixed frame to the camera frame at the time of the image as a</span>
<span class="sd">        shape 3x3 numpy array of floats. This represents the matrix as originally read into SPC (usually from spice)</span>

<span class="sd">        This corresponds to all the values of the lines containing ``CX, CY, CZ`` in the NOM file.  The matrix is formed </span>
<span class="sd">        according to ``np.vstack([CX, CY, CZ])`` </span>
<span class="sd">        </span>
<span class="sd">        Defaults to a 3x3 array of all zeros</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the position_camera_to_target vector as a length 3 numpy array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values for each component of the position vector.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_VSO`` in the NOM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the rotation from the target body frame to the spacecraft frame as a length 3 numpy </span>
<span class="sd">        array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_PTG`` in the NOM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This specifies the frame the sig_pos_camera_to_target is specified in.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the label on the velocity line in the NOM file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the empty string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ending</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This corresponds to the end of the Nominal file (essentially anything that wasn&#39;t captured) and is a fall back </span>
<span class="sd">        for future additions.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the empty string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span>
        <span class="k">if</span> <span class="n">position_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">position_camera_to_target</span>
        <span class="k">if</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span>
        <span class="k">if</span> <span class="n">rotation_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">rotation_target_fixed_to_camera</span>
        <span class="k">if</span> <span class="n">sig_pos_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">sig_pos_camera_to_target</span>
        <span class="k">if</span> <span class="n">sig_rot_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">sig_rot_target_fixed_to_camera</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="k">if</span> <span class="n">ending</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ending</span> <span class="o">=</span> <span class="n">ending</span>

<div class="viewcode-block" id="Nominal.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.read.html#giant.utilities.stereophotoclinometry.Nominal.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC NOM file (normally ``NOMINALS/*IMAGENAME*.NOM``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The file name must be provided for a call to read&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nominal</span><span class="p">:</span>
            <span class="c1"># parse the name line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># read in the spacecraft velocity vector and frame specifier for the uncertainty</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the spacecraft position vector</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the sigma_VSO values (whatever that is)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the rotation matrix from the body frame to the camera frame</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the sigma_PTG values (whatever that is)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ending</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>


<div class="viewcode-block" id="Nominal.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.write.html#giant.utilities.stereophotoclinometry.Nominal.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Nominal.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Nominal.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:20.10E}</span><span class="s1"> </span><span class="si">{1:19.10E}</span><span class="s1"> </span><span class="si">{2:19.10E}</span><span class="s1">   &#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;image_name should not be None at this point&quot;</span>
        <span class="n">name_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>

        <span class="n">velocity_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">position_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SCOBJ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sig_vso_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;SIGMA_VSO</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">rot_x_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CX</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_y_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CY</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_z_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sig_ptg_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;SIGMA_PTG</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># open/create the file for writing</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nominal</span><span class="p">:</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">velocity_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">position_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_vso_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_x_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_y_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_z_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_ptg_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ending</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Landmark">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.html#giant.utilities.stereophotoclinometry.Landmark">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Landmark</span><span class="p">(</span><span class="n">AttributeEqualityComparison</span><span class="p">,</span> <span class="n">AttributePrinting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Landmark files.</span>

<span class="sd">    The Landmark files specify information about a landmark (or center of a Maplet).</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: ability to read/write PICTURES, MAP OVERLAYS, and LIMB FITS sections</span>
    <span class="c1"># TODO: update the attribute names to be more descriptive</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">scale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigkm</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rmslmk</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vlm</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rot_map2body</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_lmk</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the landmark file</span>
<span class="sd">        :param name: the name of the landmark</span>
<span class="sd">        :param size: half the size of the corresponding maplet</span>
<span class="sd">        :param scale: The ground sample distance of the corresponding maplet in units of km</span>
<span class="sd">        :param sigkm: The uncertainty of something</span>
<span class="sd">        :param rmslmk: The rms of something</span>
<span class="sd">        :param vlm: the body-fixed landmark vectore</span>
<span class="sd">        :param rot_map2body: the rotation matrix from the corresponding maplet frame to the body fixed frame</span>
<span class="sd">        :param sigma_lmk: the uncertainty on the body fixed landmark vector</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark.  </span>
<span class="sd">        </span>
<span class="sd">        This should be a 6 character string, typically alpha-numeric.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first line of the LMK file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the empty string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">49</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Half the number of grid cells on a side for the corresponding Maplet minus 1.</span>
<span class="sd">        </span>
<span class="sd">        This is computed as to size=(n_rows - 1)/2 where n_rows is the number of rows in the corresponding </span>
<span class="sd">        Maplet (or number of columns since Maplets are always square).</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first component of the SIZE, SCALE line in the LMK file, usually the second line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 49</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ground sample distance of each grid cell for the corresponding Maplet in units of KM.</span>

<span class="sd">        This corresponds to the second component of the SIZE, SCALE line in the LMK file, usually the second line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15e-3</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on the landmark body fixed vector in units of km?</span>
<span class="sd">        </span>
<span class="sd">        this corresponds to the first component of the SIGKM, RMSLMK line in the LMK file, usually the fourth line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 0.15e-3.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15e-3</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The residual RMS of the landmark body fixed vector in units of km?</span>

<span class="sd">        This corresponds to the second component of the SIGKM, RMSLMK line in the LMK file, usually the fourth line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 0.15e-3.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The body-fixed landmark vector in units of km as a length 3 numpy array of floats</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the components of the VLM line in the LMK file, usually the fifth line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the corresponding Maplet local frame to the body-fixed frame as a 3x3 numpy array of </span>
<span class="sd">        floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the components of the UX, UY, and UZ lines in the LMK file, usually lines 6-9.  This </span>
<span class="sd">        matrix is formed according to np.vstack([UX, UY, UZ]).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the 3x3 identity matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mf">0.15e-3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on all of the components of the landmark body fixed vector in units of km.</span>

<span class="sd">        This corresponds all of the second component of the SIMGA_LMK line in the LMK file, usually the tenth line.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to an array of [0.15e-3, 0.15e-3, 0.15e-3]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">sigkm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span> <span class="o">=</span> <span class="n">sigkm</span>
        <span class="k">if</span> <span class="n">rmslmk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span> <span class="o">=</span> <span class="n">rmslmk</span>
        <span class="k">if</span> <span class="n">vlm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span> <span class="o">=</span> <span class="n">vlm</span>
        <span class="k">if</span> <span class="n">rot_map2body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span> <span class="o">=</span> <span class="n">rot_map2body</span>
        <span class="k">if</span> <span class="n">sigma_lmk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span> <span class="o">=</span> <span class="n">sigma_lmk</span>
            
<div class="viewcode-block" id="Landmark.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.write.html#giant.utilities.stereophotoclinometry.Landmark.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Landmark.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Landmark.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">size_scale_format</span> <span class="o">=</span> <span class="s1">&#39;     </span><span class="si">{:&gt;3d}</span><span class="s1">   </span><span class="si">{:.7f}</span><span class="s1">                                           SIZE, SCALE(KM)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sig_format</span> <span class="o">=</span> <span class="s1">&#39;   </span><span class="si">{:&gt; 16.10e}</span><span class="s1">   </span><span class="si">{:&gt; 16.10e}</span><span class="s1">                       SIGKM, RMSLMK</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;   </span><span class="si">{:&gt; 16.10e}</span><span class="s1">   </span><span class="si">{:&gt; 16.10e}</span><span class="s1">   </span><span class="si">{:&gt; 16.10e}</span><span class="s1">   </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">   T</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">size_scale_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;        -1        -1        -1        -1                       HORIZON</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vlm</span><span class="p">,</span> <span class="s1">&#39;VLM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;UX&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;UY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;UZ&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span><span class="p">,</span> <span class="s1">&#39;SIMGA_LMK&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;PICTURES</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;MAP OVERLAPS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LIMB FITS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END FILE&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Landmark.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.read.html#giant.utilities.stereophotoclinometry.Landmark.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC LMK file (normally ``LMKFILES/*MAPLETNAME*.LMK``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the LMK data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>

            <span class="c1"># parse the name and observation_date lines (first two lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># parse the size and scale</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># get sigkm and rmslmk</span>
            <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># skip the HORIZON line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># parse the body to landmark position vector</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="c1"># parse the landmark to body rotation matrix</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="c1"># parse the landmark uncertainty</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span></div>
</div>

            

<div class="viewcode-block" id="MapletTransformationPrecision">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.MapletTransformationPrecision.html#giant.utilities.stereophotoclinometry.MapletTransformationPrecision">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MapletTransformationPrecision</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent the level of precision for the maplet transformation components (position_objmap and rotation_maplet2body).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">SINGLE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single precision, 4 bytes (the official Maplet precision)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">DOUBLE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Double precision, 8 bytes (not officially supported)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Maplet">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.html#giant.utilities.stereophotoclinometry.Maplet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Maplet</span><span class="p">(</span><span class="n">AttributePrinting</span><span class="p">,</span> <span class="n">AttributeEqualityComparison</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Maplet files.</span>

<span class="sd">    The Maplet files specify local terrain and albedo data for a landmark.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: update the attribute names to be more descriptive</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">scale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">position_objmap</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_maplet2body</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">hscale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">heights</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">albedos</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">transformation_precision</span><span class="p">:</span> <span class="n">MapletTransformationPrecision</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the Maplet file</span>
<span class="sd">        :param name: the name of the Maplet</span>
<span class="sd">        :param size: half the size of the maplet</span>
<span class="sd">        :param scale: The ground sample distance of the maplet in units of km</span>
<span class="sd">        :param position_objmap: the body-fixed center of the maplet (Landmark)</span>
<span class="sd">        :param rotation_maplet2body: The rotation from the local maplet frame to the body fixed frame</span>
<span class="sd">        :param hscale: The scaling term used to convert maplet heights between a float in units of scale and an integer</span>
<span class="sd">                       for file storage.</span>
<span class="sd">        :param heights: The height data for the maplet expressed in the local maplet frame as a 2*size+1 by 2*size+1 2D</span>
<span class="sd">                        numpy array</span>
<span class="sd">        :param albedos: the relative albedo data for the maplet expressed in the local maplet frame as a 2*size+1 by</span>
<span class="sd">                        2*size+1 2D numpy array</span>
<span class="sd">        :param transformation_precision: the precision to use for storing/reading the transformation information in the file (position_objmap and rotation_maplet2body).  </span>
<span class="sd">                                         Note that this should pretty much always be left to SINGLE as that is the only officially supported precision.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">precision_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span> <span class="k">if</span> <span class="n">transformation_precision</span> <span class="o">==</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">DOUBLE</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the Maplet.  </span>

<span class="sd">        This should be a 6 character string, typically alpha-numeric.</span>

<span class="sd">        This corresponds to the name of the maplet file, not including the the extension.  It is provided for </span>
<span class="sd">        convenience and is not used in either reading or writing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">49</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Half the number of grid cells on a side for the Maplet minus 1.</span>

<span class="sd">        This is computed as to size=(n_rows - 1)/2 where n_rows is the number of rows in the </span>
<span class="sd">        Maplet (or number of columns since Maplets are always square).</span>

<span class="sd">        This corresponds to the 16bit unsigned integer in the 11th and 12th bytes of the maplet file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ground sample distance of each grid cell for the Maplet in units of KM.</span>

<span class="sd">        This corresponds to the 32bit float in the 7th through 10th bytes of the maplet file.</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">precision_dtype</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The body-fixed landmark vector in units of km as a length 3 numpy array of floats</span>

<span class="sd">        This corresponds to the 3 32bit floats in the 16th--28th bytes of the maplet file</span>
<span class="sd">        or the 3 64 bit floats in the 16th--40th bytes of the maplet file if the transformation precision is set to double </span>
<span class="sd">        (unsupported outside of GIANT).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">precision_dtype</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the Maplet local frame to the body-fixed frame as a 3x3 numpy array of </span>
<span class="sd">        floats.</span>

<span class="sd">        This corresponds to the 9 32bit floats in the 29th--55th bytes of the maplet file</span>
<span class="sd">        or the 9 64 bit floats in the 41st--113th bytes of the maplet file if the transformation precision is set to double</span>
<span class="sd">        (unsupported outside of GIANT).</span>
<span class="sd">        </span>
<span class="sd">        Defaults to the 3x3 identity matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The scale used to convert heights from a float to a 16byte signed integer in the maplet file.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the 32bit float in the 56th byte of the maplet file </span>
<span class="sd">        or the 114th byte of the maplet file if the transformation precision is set to double</span>
<span class="sd">        (unsupported outside of GIANT)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">heights</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The height profile for the maplet as a 2*size+1 by 2*size+1 2D numpy array</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the 16bit signed integers in the remaining data in the maplet file, but have been converted</span>
<span class="sd">        to floats using hscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The relative albedo profile for the maplet as a 2*size+1 by 2*size+1 2D numpy array.</span>
<span class="sd">        </span>
<span class="sd">        this corresponds to the 8 bit unsigned integers in the remaining data in the maplet file, but have been </span>
<span class="sd">        converted to floats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span><span class="p">:</span> <span class="n">MapletTransformationPrecision</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">transformation_precision</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The precision to use to read/write the transformation information in files.</span>
<span class="sd">        </span>
<span class="sd">        Note that DOUBLE precision is not officially supported and should only be used if you know what you are doing.</span>
<span class="sd">        </span>
<span class="sd">        This is unsupported outside of GIANT</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">position_objmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">=</span> <span class="n">position_objmap</span>
        <span class="k">if</span> <span class="n">rotation_maplet2body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">=</span> <span class="n">rotation_maplet2body</span>
        <span class="k">if</span> <span class="n">hscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">=</span> <span class="n">hscale</span>
        <span class="k">if</span> <span class="n">heights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">=</span> <span class="n">heights</span>
        <span class="k">if</span> <span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">albedos</span>

<div class="viewcode-block" id="Maplet.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.read.html#giant.utilities.stereophotoclinometry.Maplet.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Maplet file (normally ``MAPFILES/*MAPLETNAME*.MAP``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the MAP data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">map_fileobj</span><span class="p">:</span>
            <span class="c1"># READ IN THE MAPLET HEADER</span>

            <span class="c1"># check if the first 6 bytes specify the precision</span>
            <span class="n">prec</span> <span class="o">=</span> <span class="n">map_fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prec</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;DOUBLE&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span>  <span class="o">=</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">DOUBLE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="o">=</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">SINGLE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prec</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;SINGLE&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: file indicates single precision but double precision requested.  Things are probalby going to break&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">prec</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DOUBLE&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: file indicates single precision but double precision requested.  Things are probalby going to break&#39;</span><span class="p">)</span>

            <span class="c1"># read in the scale using numpy&#39;s from file</span>
            <span class="c1"># note that here the &gt; in the dtype indicates big endianess</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># read in the Maplet size using little endian order because SPC...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;u2&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">map_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># skip the next three bytes from the current position</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># read in the body-maplet vector expressed in the body frame</span>
            <span class="n">tprec</span> <span class="o">=</span> <span class="s1">&#39;&gt;f4&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">SINGLE</span> <span class="k">else</span> <span class="s1">&#39;&gt;f8&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tprec</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the maplet2body frame rotation matrix.</span>
            <span class="c1"># Need to use reshape to form into a matrix given the vector of data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tprec</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># read in the height scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># skip five bytes from the current position</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># read in the height and albedo data</span>
            <span class="c1"># read in the data as a structured array where the first element in each tuple is the height data</span>
            <span class="c1"># and the second element in each tuple is the albedo data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;i2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;u1&#39;</span><span class="p">)])</span>

            <span class="c1"># get how much of that is extraneous data by comparing with the total number of elements in the Maplet</span>
            <span class="n">num_pad</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">num_pad</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1"># remove the extraneous data from the end</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">num_pad</span><span class="p">]</span>

            <span class="c1"># extract the height data from the structured array</span>
            <span class="n">height_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

            <span class="c1"># extract the albedo data from the structured array</span>
            <span class="n">albedo_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span>

            <span class="c1"># set the height data to 0 wherever the albedo data is zero</span>
            <span class="n">height_data</span><span class="p">[</span><span class="n">albedo_data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># multiply by the height data scale and reshape into the appropriate Maplet size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">*</span> <span class="n">height_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">map_shape</span><span class="p">)</span>

            <span class="c1"># reshape the albedo data into the appropriate Maplet size and change to decimal form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">albedo_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">map_shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="Maplet.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.write.html#giant.utilities.stereophotoclinometry.Maplet.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Maplet.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Maplet.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">map_fileobj</span><span class="p">:</span>
            <span class="c1"># mark that the first six bytes are not used</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;SINGLE&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">SINGLE</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;DOUBLE&#39;</span><span class="p">)</span>

            <span class="c1"># write the Maplet scale as a 4 byte float using big endian encoding</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;f&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>

            <span class="c1"># write the Maplet size to file using little endian encoding... because SPC...</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

            <span class="c1"># write the Maplet position and placeholders for the formal uncertainty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="n">MapletTransformationPrecision</span><span class="o">.</span><span class="n">SINGLE</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_precision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stprec</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> 
                <span class="n">ntprec</span> <span class="o">=</span> <span class="s1">&#39;&gt;f4&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stprec</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>
                <span class="n">ntprec</span> <span class="o">=</span> <span class="s1">&#39;&gt;f8&#39;</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;xxx&#39;</span><span class="o">+</span><span class="n">stprec</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span><span class="p">))</span>

            <span class="c1"># write the Maplet to body rotation matrix</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ntprec</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>

            <span class="c1"># write in the scaling term for the Maplet height</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;f&#39;</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span><span class="p">))</span>

            <span class="c1"># write in the Maplet height and albedo data</span>
            <span class="c1"># first determine the total number of pixels we have to store</span>
            <span class="n">num_pixels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

            <span class="c1"># now determine how many records of 72 bytes that is going to take</span>
            <span class="n">num_records</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">num_pixels</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">72</span><span class="p">))</span>

            <span class="c1"># get the number of bytes that we will need to pad to fill up these records</span>
            <span class="n">num_pads</span> <span class="o">=</span> <span class="mi">72</span> <span class="o">*</span> <span class="n">num_records</span> <span class="o">-</span> <span class="n">num_pixels</span> <span class="o">*</span> <span class="mi">3</span>

            <span class="c1"># reshape the matrices into the required format and put the data in the proper format</span>
            <span class="c1"># first we need to scale the height data and round the scaled data to the nearest integers</span>
            <span class="c1"># (because this helps with storage requirements).  Then we use the convenient .reshape(-1)</span>
            <span class="c1"># to form a vector from the matrix, but we can only do this as an array type so we need to</span>
            <span class="c1"># use the asarray method</span>
            <span class="n">height_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># Check whether any albedo data lies outside of the uint8 range from (0, 2.55).</span>
            <span class="n">albedo_out_of_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">&gt;</span> <span class="mf">2.55</span><span class="p">)</span>
            
            <span class="c1"># If any albedo data is outside of the uint8 casting range, throw a warning.</span>
            <span class="k">if</span> <span class="n">albedo_out_of_range</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Some Maplet.albedos data lies outside of the expected range from (0, 2.55). &#39;</span> \
                              <span class="s1">&#39;When writing a Maplet object to a file, the albedo data will be cast as uint8 &#39;</span> \
                              <span class="s1">&#39;into the 0-255 range.&#39;</span><span class="p">)</span>

            <span class="c1"># do the same thing for the albedo data</span>
            <span class="c1"># noinspection PyArgumentList</span>
            <span class="n">albedo_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># combine into a structured numpy array for creating the binary representation</span>
            <span class="n">map_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">([</span><span class="n">height_data</span><span class="p">,</span> <span class="n">albedo_data</span><span class="p">],</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;heights&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;i2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;albedos&#39;</span><span class="p">,</span> <span class="s1">&#39;u1&#39;</span><span class="p">)])</span>

            <span class="c1"># write to the file -- note that for the format we write num_pixels pairs of short signed 2 byte integers</span>
            <span class="c1"># with an unsigned character and then pad with num_pads empty space</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">map_data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">num_pads</span><span class="p">)</span></div>


<div class="viewcode-block" id="Maplet.get_triangles">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.get_triangles.html#giant.utilities.stereophotoclinometry.Maplet.get_triangles">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">triangle_precision</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns GIANT triangle objects from the maplet data to be used in the GIANT ray tracer</span>

<span class="sd">        :param triangle_precision: A flag specifying whether to return 64 bit or 32 bit triangles</span>
<span class="sd">        :return: The GIANT triangles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># form the column and row labels</span>
        <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># get the vectors in the maplet frame</span>
        <span class="n">map_vecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">cols</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rows</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">heights</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>

        <span class="c1"># rotate and translate into the body fixed frame</span>
        <span class="n">body_vecs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="p">,</span> <span class="n">map_vecs</span><span class="p">))</span>

        <span class="c1"># compute the length of a side</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># make indicies for the tesselation</span>
        <span class="n">tchunk0a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">tchunk0b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">tess0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk0a</span><span class="p">,</span> <span class="n">tchunk0b</span><span class="p">])</span>

        <span class="n">tchunk1a</span> <span class="o">=</span> <span class="n">tchunk0b</span>
        <span class="n">tchunk1b</span> <span class="o">=</span> <span class="n">tchunk0b</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">tess1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk1a</span><span class="p">,</span> <span class="n">tchunk1b</span><span class="p">])</span>

        <span class="n">tchunk2a</span> <span class="o">=</span> <span class="n">tchunk0a</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">tchunk2b</span> <span class="o">=</span> <span class="n">tchunk2a</span>

        <span class="n">tess2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk2a</span><span class="p">,</span> <span class="n">tchunk2b</span><span class="p">])</span>

        <span class="n">tess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">tess0</span><span class="p">,</span> <span class="n">tess2</span><span class="p">,</span> <span class="n">tess1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># get the albedos in the proper format</span>
        <span class="n">albs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># form the triangles and return</span>
        <span class="k">match</span> <span class="n">triangle_precision</span><span class="p">:</span>
            <span class="k">case</span> <span class="mi">32</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Triangle32</span><span class="p">(</span><span class="n">body_vecs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">albs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">tess</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
                                <span class="n">compute_reference_ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">case</span> <span class="mi">64</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Triangle64</span><span class="p">(</span><span class="n">body_vecs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">albs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">tess</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
                                <span class="n">compute_reference_ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid precision specified&#39;</span><span class="p">)</span></div>
</div>



<span class="k">def</span><span class="w"> </span><span class="nf">_fortran_float_converter</span><span class="p">(</span><span class="n">in_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This utility converts fortran double precision float strings to python float strings by replacing D with e</span>

<span class="sd">    :param in_string: The fortran string containing double precision floats</span>
<span class="sd">    :return: The string ready for ingest by python float utilities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">in_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="ShapeModel">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.html#giant.utilities.stereophotoclinometry.ShapeModel">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ShapeModel</span><span class="p">(</span><span class="n">AttributeEqualityComparison</span><span class="p">,</span> <span class="n">AttributePrinting</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Shape files (Implicitly connected Quadrilateral, ICQ format).</span>

<span class="sd">    The Shape files specify the global terrain for SPC.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vertices</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">albedos</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the file to load the data from</span>
<span class="sd">        :param conversion: A conversion factor to convert the units of the shape model into the units you want.</span>
<span class="sd">                           Official SPC shape models are in km, which are the same units GIANT usually uses so this</span>
<span class="sd">                           should typically remain 1.</span>
<span class="sd">        :param grid_size: The number of cells on each side of each face for the ICQ format.  This corresponds to the</span>
<span class="sd">                          number of vertices by ``6*grid_size**2``</span>
<span class="sd">        :param vertices: The vertices for the ICQ format as a nx3 array.  The ordering of these is complicated.</span>
<span class="sd">        :param albedos: The albedos corresponding to the vertices as a nx1 array.  Alternatively can be None if no</span>
<span class="sd">                        albedo data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the shape file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The length of one side of the grid for the ICQ format</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first number in the shape file</span>
<span class="sd">        </span>
<span class="sd">        Defaults to 64</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ICQ vertices and a nx3 array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The albedo for each vertex as a nx1 array.</span>
<span class="sd">        </span>
<span class="sd">        This is optional and only included in some shape files.  It is the fourth float for each vertex in the shape </span>
<span class="sd">        file if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">conversion</span><span class="o">=</span><span class="n">conversion</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">grid_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="n">grid_size</span>
        <span class="k">if</span> <span class="n">vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span>
        <span class="k">if</span> <span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">albedos</span>

<div class="viewcode-block" id="ShapeModel.read">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.read.html#giant.utilities.stereophotoclinometry.ShapeModel.read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Shape file (normally ``SHAPEFILES/*.TXT``) and populates the attributes</span>
<span class="sd">        of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead.</span>

<span class="sd">        The argument conversion can be used to convert from the SPC units (nominally km) to another unit for the</span>
<span class="sd">        vertices.</span>

<span class="sd">        :param file_name: The file to load the Shape data from</span>
<span class="sd">        :param conversion: The conversion to apply to the verticies to change their units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shape_file</span><span class="p">:</span>

            <span class="c1"># get the grid size for each cube face</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shape_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">shape_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;vec&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>

                <span class="c1"># noinspection PyTypeChecker</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># noinspection PyTypeChecker</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">1</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ShapeModel.write">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.write.html#giant.utilities.stereophotoclinometry.ShapeModel.write">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.ShapeModel.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.ShapeModel.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">vec_fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt; 13.5e}{:&gt; 13.5e}{:&gt; 13.5e}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">alb_fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt; 13.5e}{:&gt; 13.5e}{:&gt; 13.5e}{:&gt; 13.5e}</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;12d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="p">):</span>
                    <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">alb_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                    <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vec_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="ShapeModel.get_triangles">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.get_triangles.html#giant.utilities.stereophotoclinometry.ShapeModel.get_triangles">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">triangle_precision</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;64&#39;</span><span class="p">,</span> <span class="s1">&#39;32&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;64&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns GIANT triangle objects from the maplet data to be used in the GIANT ray tracer</span>

<span class="sd">        :param triangle_precision: A flag specifying whether to return 64 bit or 32 bit triangles</span>
<span class="sd">        :return: The GIANT triangles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">albedos</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">albedos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">icq_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">))</span>
        <span class="n">triangulated_icq_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">icq_indices</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">facets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">triangulated_icq_indices</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                                 <span class="n">triangulated_icq_indices</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">triangle_precision</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;32&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Triangle32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">albedos</span><span class="p">,</span> <span class="n">facets</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
            <span class="k">case</span> <span class="s1">&#39;64&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Triangle64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">albedos</span><span class="p">,</span> <span class="n">facets</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid triangle_precision&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="get_distortion">
<a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.get_distortion.html#giant.utilities.stereophotoclinometry.get_distortion">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_distortion</span><span class="p">(</span><span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lithos_file</span><span class="p">:</span> <span class="n">PATH</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the distortion value from the lithos file pertaining to a specified image</span>

<span class="sd">    :param image_name:  The name of the Image that the distortion belongs to</span>
<span class="sd">    :param lithos_file:  The lithos file to read from</span>
<span class="sd">    :return distortion: A numpy matrix vector containing the distortion model coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lithos_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lithos</span><span class="p">:</span>

        <span class="n">lithos_lines</span> <span class="o">=</span> <span class="n">lithos</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lithos_lines</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">lithos_lines</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">),</span>
                                           <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distortion</span></div>


</pre></div>

          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer">
    <div style="display:inline-block;vertical-align:middle;">
        <img src="/_static/NASA_logo.svg" alt="NASA" style="width:80px;height:80px;">
    </div>
    <div style="display:inline-block;vertical-align:middle;">
        &copy;2023 United States Government | 
        NASA Official: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a> |
        Curator: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a>
        <br>
        Last updated on Sep 03, 2025 |
        
        |
        Powered by <a href="http://sphinx-doc.org/">Sphinx 8.2.3</a>
        &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 1.0.0</a>
        
        |
        <a href="https://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Policy/Notices</a>
    </div>
</div>
  </body>
</html>