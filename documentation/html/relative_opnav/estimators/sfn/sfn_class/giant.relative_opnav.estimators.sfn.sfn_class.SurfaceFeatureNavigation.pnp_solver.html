<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SurfaceFeatureNavigation.pnp_solver &#8212; GIANT 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=3f530b75" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=aae3c237" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="SurfaceFeatureNavigation.render" href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.render.html" />
    <link rel="prev" title="SurfaceFeatureNavigation.estimate" href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.estimate.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/logo.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">A powerful API for Optical Navigation</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installing GIANT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../giant.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../giant.html#indices">Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../copyright.html">Copyright</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../giant.html">API Reference</a><ul>
  <li><a href="../../../../giant.relative_opnav.html">giant.relative_opnav</a><ul>
  <li><a href="../../../giant.relative_opnav.estimators.html">estimators</a><ul>
  <li><a href="../../giant.relative_opnav.estimators.sfn.html">sfn</a><ul>
  <li><a href="../giant.relative_opnav.estimators.sfn.sfn_class.html">sfn_class</a><ul>
  <li><a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.html">SurfaceFeatureNavigation</a><ul>
      <li>Previous: <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.estimate.html" title="previous chapter">SurfaceFeatureNavigation.estimate</a></li>
      <li>Next: <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.render.html" title="next chapter">SurfaceFeatureNavigation.render</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.estimate.html" title="Previous document">SurfaceFeatureNavigation.estimate</a>
        </li>
        <li>
          <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.render.html" title="Next document">SurfaceFeatureNavigation.render</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="surfacefeaturenavigation-pnp-solver">
<h1>SurfaceFeatureNavigation.pnp_solver<a class="headerlink" href="#surfacefeaturenavigation-pnp-solver" title="Link to this heading">¶</a></h1>
<p><a class="reference internal" href="../giant.relative_opnav.estimators.sfn.sfn_class.html#module-giant.relative_opnav.estimators.sfn.sfn_class" title="giant.relative_opnav.estimators.sfn.sfn_class"><code class="xref py py-mod docutils literal notranslate"><span class="pre">giant.relative_opnav.estimators.sfn.sfn_class</span></code></a>:</p>
<dl class="py method">
<dt class="sig sig-object py" id="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.pnp_solver">
<span class="sig-prename descclassname"><span class="pre">SurfaceFeatureNavigation.</span></span><span class="sig-name descname"><span class="pre">pnp_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_ind</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/giant/relative_opnav/estimators/sfn/sfn_class.html#SurfaceFeatureNavigation.pnp_solver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.pnp_solver" title="Link to this definition">¶</a></dt>
<dd><p>This method attempts to solve for an update to the relative position/orientation of the target with respect to
the image based on the observed feature locations in the image.</p>
<p>We solve the PnP problem here looking for an update (ie not trying to solve the lost in space problem).  This is
done for 2 reasons.  First, it reflects what we’re doing.  In order to find the surface features in the image we
need some reasonable a priori knowledge of the relative position/orientation between the camera and the target
so we might as well use it (since it makes things simpler).  Second, because the PnP problem can be fickle,
especially if the observations are noisy (as they can sometimes be if our a priori knowledge was not the
greatest) by solving for an update we force it to stay near the a priori knowledge which helps to prevent
outlandish solutions, even when there are very few points available.</p>
<p>Because we are doing an update PnP solution we simply solve a nonlinear least squares problem for the
translation and rotation (cast as a 3 element rotation vector) that minimizes the error between the predicted
feature locations in the image and the observed feature locations.  This is generally robust and fast,
especially since we can easily compute the analytic Jacobian for the least squares problem.  Specifically, the
problem we are trying to minimize is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{r}_i = \mathbf{y}_i-f\left((\mathbf{I}-[\boldsymbol{\delta\theta}\times])
(\mathbf{x}_i+\mathbf{d})\right) \\
\min_{\mathbf{d},\boldsymbol{\delta\theta}}\left\{\sum_i \mathbf{r}_i^T\mathbf{r}_i\right\}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{d}\)</span> is the shift, <span class="math notranslate nohighlight">\(\boldsymbol{\delta\theta}\)</span> is the rotation vector,
<span class="math notranslate nohighlight">\(\mathbf{y}_i\)</span> is the observed location of the <span class="math notranslate nohighlight">\(i^{th}\)</span> features, <span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span> is the
location of the <span class="math notranslate nohighlight">\(i^{th}\)</span> feature center in the current a priori camera frame, <span class="math notranslate nohighlight">\(\mathbf{I}\)</span> is a
3x3 identity matrix, and <span class="math notranslate nohighlight">\(f(\bullet)\)</span> is the function which transforms points in the camera frame to
points in the image (<a class="reference internal" href="../../../../camera_model/giant.camera_models.camera_model.CameraModel.project_onto_image.html#giant.camera_models.camera_model.CameraModel.project_onto_image" title="giant.camera_models.camera_model.CameraModel.project_onto_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CameraModel.project_onto_image()</span></code></a>).</p>
<p>In addition, we provide the option to use RANSAC when solving the PnP problem to attempt to reject outliers in
the solution.  This is very useful and should typically be used when possible (RANSAC will not be used when the
number of observed features is less than 8).  We implement a typical RANSAC algorithm, where we choose a
subsample of the available measurements, compute the PnP solution using the sample, and then compute the
statistics/number of inliers from the full set of measurements given the estimated location from the sample,
keeping the one with the most inliers and lowest statistics.</p>
<p>To apply the results of this method to a scene object you should do <code class="docutils literal notranslate"><span class="pre">object.translate(shift)</span></code> and then
<code class="docutils literal notranslate"><span class="pre">object.rotate(rotation)</span></code> where <code class="docutils literal notranslate"><span class="pre">object</span></code> is the scene object, <code class="docutils literal notranslate"><span class="pre">shift</span></code> is the shift vector from this
method, and <code class="docutils literal notranslate"><span class="pre">rotation</span></code> is the rotation from this method (note translate first, then rotate).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_ind</strong> (<em>int</em>) – The index of the target that we are currently doing the PnP problem with respect to</p></li>
<li><p><strong>image</strong> (<a class="reference internal" href="../../../../image/giant.image.OpNavImage.html#giant.image.OpNavImage" title="giant.image.OpNavImage"><em>OpNavImage</em></a>) – The image that we are currently solving the PnP problem for</p></li>
<li><p><strong>image_ind</strong> (<em>int</em>) – The index of the image that we are solving the PnP problem for. (This only really matters if
you still have per image misalignments in your camera model still for some reason)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The best fit shift as a length 3 numpy array in km and rotation as a <a class="reference internal" href="../../../../rotations/rotation/giant.rotations.rotation.Rotation.html#giant.rotations.rotation.Rotation" title="giant.rotations.rotation.Rotation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rotation</span></code></a> to go from the
current camera frame to the new camera frame if successful or <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tuple</em>[<em>ndarray</em>, <a class="reference internal" href="../../../../rotations/rotation/giant.rotations.rotation.Rotation.html#giant.rotations.rotation.Rotation" title="giant.rotations.rotation.Rotation"><em>Rotation</em></a>] | tuple[None, None]</p>
</dd>
</dl>
</dd></dl>

<div class="line-block">
<div class="line"><br /></div>
</div>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.estimate.html" title="Previous document">SurfaceFeatureNavigation.estimate</a>
        </li>
        <li>
          <a href="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.render.html" title="Next document">SurfaceFeatureNavigation.render</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer">
    <div style="display:inline-block;vertical-align:middle;">
        <img src="/_static/NASA_logo.svg" alt="NASA" style="width:80px;height:80px;">
    </div>
    <div style="display:inline-block;vertical-align:middle;">
        &copy;2023 United States Government | 
        NASA Official: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a> |
        Curator: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a>
        <br>
        Last updated on Sep 03, 2025 |
        
        |
        Powered by <a href="http://sphinx-doc.org/">Sphinx 8.2.3</a>
        &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 1.0.0</a>
        
        |
        <a href="https://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Policy/Notices</a>
    </div>
</div>
  </body>
</html>