<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>sfn_correlator &#8212; GIANT 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=3f530b75" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=aae3c237" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="surface_features" href="../giant.relative_opnav.estimators.sfn.surface_features.html" />
    <link rel="prev" title="sfn_correlators" href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/logo.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">A powerful API for Optical Navigation</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installing GIANT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../giant.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../giant.html#indices">Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../copyright.html">Copyright</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../giant.html">API Reference</a><ul>
  <li><a href="../../../../giant.relative_opnav.html">giant.relative_opnav</a><ul>
  <li><a href="../../../giant.relative_opnav.estimators.html">estimators</a><ul>
  <li><a href="../../giant.relative_opnav.estimators.sfn.html">sfn</a><ul>
  <li><a href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html">sfn_correlators</a><ul>
      <li>Previous: <a href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html" title="previous chapter">sfn_correlators</a></li>
      <li>Next: <a href="../giant.relative_opnav.estimators.sfn.surface_features.html" title="next chapter">surface_features</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html" title="Previous document">sfn_correlators</a>
        </li>
        <li>
          <a href="../giant.relative_opnav.estimators.sfn.surface_features.html" title="Next document">surface_features</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="sfn-correlator">
<h1>sfn_correlator<a class="headerlink" href="#sfn-correlator" title="Link to this heading">¶</a></h1>
<p><a class="reference internal" href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html#module-giant.relative_opnav.estimators.sfn.sfn_correlators" title="giant.relative_opnav.estimators.sfn.sfn_correlators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">giant.relative_opnav.estimators.sfn.sfn_correlators</span></code></a>:</p>
<dl class="py function">
<dt class="sig sig-object py" id="giant.relative_opnav.estimators.sfn.sfn_correlators.sfn_correlator">
<span class="sig-prename descclassname"><span class="pre">giant.relative_opnav.estimators.sfn.sfn_correlators.</span></span><span class="sig-name descname"><span class="pre">sfn_correlator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">space_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intersects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_dist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_predicted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#giant.relative_opnav.estimators.sfn.sfn_correlators.sfn_correlator" title="Link to this definition">¶</a></dt>
<dd><p>This function performs normalized cross correlation in the spatial domain over a given search distance about a
center between an image and a template using masks.</p>
<p>The correlation is performed by aligning the center of the template with various gridded points in the image
centered on the predicted location of the center of the template in the image and extending to +/- <code class="docutils literal notranslate"><span class="pre">search_dist</span></code>
in both the rows and columns.  At each alignment, the Pearson Product moment correlation between the template and
the overlaid portion of the image is computed and stored into a <code class="docutils literal notranslate"><span class="pre">(2*search_dist+1,</span> <span class="pre">2*search_dist+1)</span></code> correlation
surface. During the Pearson Product moment correlation computation, 2 masks are checked with a logical or to see if
the pixel should be included in the computation. Anywhere that the template and the image do not overlap we also
do not include in the computation of the Pearson Product moment correlation coefficient.</p>
<p>The first mask, <code class="docutils literal notranslate"><span class="pre">space_mask</span></code> should be the same size as the image and have
a value of <code class="docutils literal notranslate"><span class="pre">True</span></code> for anywhere in the image that contains empty space, and a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> for anywhere in
the image that contains an extended body.  The second mask, <code class="docutils literal notranslate"><span class="pre">intersects</span></code> should be the same size as the template
and should have a value of <code class="docutils literal notranslate"><span class="pre">True</span></code> for anywhere in the template where a ray shot through the pixel intersected a
surface and a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> for anywhere in the template where no rays shot through the pixel intersected a
surface.  The purpose of these masks is to exclude regions of the template that were not rendered, since we
normally render a few pixels around the edge of the template to ensure we capture all of it, while still including
regions of the image which included empty space.  This largely only affects templates that are very near the limb
of the observed body.</p>
<p>For the correlation surface that is returned, the center pixel (<code class="docutils literal notranslate"><span class="pre">np.array(surface.shape)//2</span></code>) represents a shift
of 0 from the predicted template center location in the image.  Any location with a row/column less than the center
pixel is a negative shift, a vice-versa for anywhere greater.  Therefore, the shift from the nominal location can be
notionally found using <code class="docutils literal notranslate"><span class="pre">shift</span> <span class="pre">=</span> <span class="pre">np.unravel_index(surface.argmax(),</span> <span class="pre">surface.shape)</span> <span class="pre">-</span> <span class="pre">np.array(surface.shape)//2</span></code></p>
<p>Typically this function is only used by the <a class="reference internal" href="../sfn_class/giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation.html#giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation" title="giant.relative_opnav.estimators.sfn.sfn_class.SurfaceFeatureNavigation"><code class="xref py py-class docutils literal notranslate"><span class="pre">SurfaceFeatureNavigation</span></code></a> class.  In fact, it should not be
used as the correlator for most other classes, which assume the correlator does a global search instead of a local
search.</p>
<p>We here provide an example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">giant.relative_opnav.estimators.sfn.sfn_correlators</span><span class="w"> </span><span class="kn">import</span> <span class="n">sfn_correlator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example_template</span> <span class="o">=</span> <span class="n">example_image</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># set the intersect mask to just include part of the interior</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">intersect_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">example_template</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">intersect_mask</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span> <span class="n">the</span> <span class="n">space_mask</span> <span class="n">to</span> <span class="n">be</span> <span class="nb">all</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">space_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">example_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">surface</span> <span class="o">=</span> <span class="n">sfn_correlator</span><span class="p">(</span><span class="n">example_image</span><span class="p">,</span> <span class="n">example_template</span><span class="p">,</span> <span class="n">space_mask</span><span class="o">=</span><span class="n">space_mask</span><span class="p">,</span> <span class="n">intersects</span><span class="o">=</span><span class="n">intersect_mask</span><span class="p">,</span>
<span class="gp">... </span>                         <span class="n">search_dist</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">center_predicted</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">argmax</span><span class="p">(),</span> <span class="n">surface</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># find the location of the template center in the image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span>
<span class="go">array([45, 52])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>numpy.ndarray</em>) – The image we are correlating with as a numpy array</p></li>
<li><p><strong>template</strong> (<em>numpy.ndarray</em>) – The template we are trying to find in the image</p></li>
<li><p><strong>space_mask</strong> (<em>Optional</em><em>[</em><em>numpy.ndarray</em><em>]</em>) – A numpy boolean array specifying which portions of the image are space and thus should be
included in computing the correlation score.  If <code class="docutils literal notranslate"><span class="pre">None</span></code> then it is assumed to all be <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>intersects</strong> (<em>Optional</em><em>[</em><em>numpy.ndarray</em><em>]</em>) – A numpy boolean array specifying which portions of the template were actually intersected by rays
and which were empty space.  Only points intersected are included in the computation of the
correlation score.  If <code class="docutils literal notranslate"><span class="pre">None</span></code> then all points are considered.</p></li>
<li><p><strong>search_dist</strong> (<em>int</em>) – The number of pixels around the predicted center of the template in the image to search.</p></li>
<li><p><strong>center_predicted</strong> (<em>Optional</em><em>[</em><em>numpy.ndarray</em><em>]</em>) – The predicted center of the template in the image.  If <code class="docutils literal notranslate"><span class="pre">None</span></code> then it is assumed the
center of the template is near the center of the image.  Note that this is (x, y) or
(col, row)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A correlation surface of shape <code class="docutils literal notranslate"><span class="pre">(search_dist*2+1,</span> <span class="pre">search_dist*2+1)</span></code> as a numpy array with values between
-1 and 1 where 1 indicates perfect positive correlation and -1 indicates perfect negative correlation.  The
center of the correlation surface corresponds to a shift of 0 between the expected template location and
the found template location.  Values past the center indicate a postive shift and values before the center
indicate a negative shift</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<div class="line-block">
<div class="line"><br /></div>
</div>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../giant.relative_opnav.estimators.sfn.sfn_correlators.html" title="Previous document">sfn_correlators</a>
        </li>
        <li>
          <a href="../giant.relative_opnav.estimators.sfn.surface_features.html" title="Next document">surface_features</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer">
    <div style="display:inline-block;vertical-align:middle;">
        <img src="/_static/NASA_logo.svg" alt="NASA" style="width:80px;height:80px;">
    </div>
    <div style="display:inline-block;vertical-align:middle;">
        &copy;2023 United States Government | 
        NASA Official: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a> |
        Curator: <a href="mailto:andrew.j.liounis@nasa.gov">Andrew Liounis</a>
        <br>
        Last updated on Sep 03, 2025 |
        
        |
        Powered by <a href="http://sphinx-doc.org/">Sphinx 8.2.3</a>
        &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 1.0.0</a>
        
        |
        <a href="https://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Policy/Notices</a>
    </div>
</div>
  </body>
</html>